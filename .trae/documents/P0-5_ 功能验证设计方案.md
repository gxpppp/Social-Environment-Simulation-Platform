## P0-5: 功能验证 - 单元测试与集成测试

### 测试范围

#### 1. 后端单元测试
- **ModelService** - LLM调用服务
- **AgentManagerService** - Agent状态管理
- **NetworkManagerService** - 网络管理
- **EventManagerService** - 事件管理
- **TickSchedulerService** - Tick调度
- **SimulationEngineService** - 模拟引擎

#### 2. 后端集成测试
- **API端点测试** - 所有Controller
- **数据库集成** - TypeORM实体
- **WebSocket测试** - 实时通信

#### 3. 前端测试
- **组件测试** - React组件
- **服务测试** - API服务层
- **状态管理测试** - Zustand stores

### 测试策略

#### 单元测试原则
- 每个服务/函数至少一个测试用例
- 边界条件测试
- 异常处理测试
- Mock外部依赖

#### 集成测试原则
- API端到端测试
- 数据库事务回滚
- 测试数据隔离

### 测试文件结构

```
apps/api/src/
├── modules/
│   ├── model/
│   │   └── model.service.spec.ts
│   ├── simulation-engine/
│   │   ├── agent-manager.service.spec.ts
│   │   ├── network-manager.service.spec.ts
│   │   ├── event-manager.service.spec.ts
│   │   ├── tick-scheduler.service.spec.ts
│   │   └── simulation-engine.service.spec.ts
│   └── auth/
│       └── auth.service.spec.ts
└── test/
    ├── app.e2e-spec.ts
    └── jest-e2e.json

apps/web/src/
├── components/
│   └── AgentEditor/
│       └── PersonalityEditor.test.tsx
├── services/
│   └── model.service.test.ts
└── stores/
    └── settings.store.test.ts
```

### 验收标准

- [ ] 代码覆盖率 > 80%
- [ ] 所有P0功能通过测试用例
- [ ] API响应时间 < 500ms
- [ ] 模拟引擎支持100+ Agent并发

### 测试命令

```bash
# 后端测试
cd apps/api
npm run test              # 单元测试
npm run test:cov          # 覆盖率测试
npm run test:e2e          # E2E测试

# 前端测试
cd apps/web
npm run test              # 组件测试
```

请确认此设计方案后，我将立即开始实现测试代码。