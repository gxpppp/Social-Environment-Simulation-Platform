# 3. AI角色创建与管理机制

## 3.1 AI角色属性体系

### 3.1.1 属性体系架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AI角色属性体系架构                                    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      AI Agent Attribute System                      │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    基础属性 (Basic Attributes)               │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │   │
│  │  │   │  身份信息    │  │  视觉形象    │  │  基本能力    │        │   │   │
│  │  │   │             │  │             │  │             │        │   │   │
│  │  │   │ • 角色ID    │  │ • 头像      │  │ • 语言      │        │   │   │
│  │  │   │ • 名称      │  │ • 形象描述  │  │ • 知识领域  │        │   │   │
│  │  │   │ • 别名      │  │ • 风格偏好  │  │ • 技能等级  │        │   │   │
│  │  │   │ • 创建时间  │  │ • 配色方案  │  │ • 专业标签  │        │   │   │
│  │  │   └─────────────┘  └─────────────┘  └─────────────┘        │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    性格特征 (Personality)                    │   │   │
│  │  │                                                              │   │   │
│  │  │   大五人格模型 (Big Five):                                    │   │   │
│  │  │   ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐   │   │   │
│  │  │   │开放性(O)  │ │尽责性(C)  │ │外向性(E)  │ │宜人性(A)  │   │   │   │
│  │  │   │0-100分   │ │0-100分   │ │0-100分   │ │0-100分   │   │   │   │
│  │  │   └───────────┘ └───────────┘ └───────────┘ └───────────┘   │   │   │
│  │  │   ┌───────────┐                                              │   │   │
│  │  │   │神经质(N)  │  补充维度:                                   │   │   │
│  │  │   │0-100分   │  • 风险偏好  • 创新倾向  • 领导风格            │   │   │
│  │  │   └───────────┘  • 沟通风格  • 压力应对  • 学习风格            │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    知识背景 (Knowledge)                      │   │   │
│  │  │                                                              │   │   │
│  │  │   知识领域配置:                                               │   │   │
│  │  │   ┌─────────────────────────────────────────────────────┐   │   │   │
│  │  │   │ 领域名称        深度等级      更新频率      来源    │   │   │   │
│  │  │   │ ─────────────────────────────────────────────────── │   │   │   │
│  │  │   │ 经济学          专家(5)      实时         内置+外部 │   │   │   │
│  │  │   │ 心理学          熟练(3)      每周         内置      │   │   │   │
│  │  │   │ 计算机科学      精通(4)      每月         内置      │   │   │   │
│  │  │   │ ...             ...          ...          ...       │   │   │   │
│  │  │   └─────────────────────────────────────────────────────┘   │   │   │
│  │  │                                                              │   │   │
│  │  │   深度等级: 入门(1) < 了解(2) < 熟练(3) < 精通(4) < 专家(5)   │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    行为模式 (Behavior)                       │   │   │
│  │  │                                                              │   │   │
│  │  │   决策风格:                                                   │   │   │
│  │  │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │   │   │
│  │  │   │ 理性分析型  │ │ 直觉判断型  │ │ 协商共识型  │            │   │   │
│  │  │   │ 数据驱动    │ │ 经验驱动    │ │ 群体决策    │            │   │   │
│  │  │   └─────────────┘ └─────────────┘ └─────────────┘            │   │   │
│  │  │                                                              │   │   │
│  │  │   交互偏好:                                                   │   │   │
│  │  │   • 主动/被动  • 直接/委婉  • 竞争/合作  • 短期/长期           │   │   │
│  │  │                                                              │   │   │
│  │  │   响应模式:                                                   │   │   │
│  │  │   • 响应速度: 即时/快速/标准/深度思考                          │   │   │
│  │  │   • 输出长度: 简洁/适中/详细/全面                             │   │   │
│  │  │   • 表达方式: 结构化/叙述性/要点式/对话式                      │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    价值观 (Values)                           │   │   │
│  │  │                                                              │   │   │
│  │  │   价值取向维度:                                               │   │   │
│  │  │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │   │   │
│  │  │   │ 个人vs集体  │ │ 稳定vs变革  │ │ 竞争vs协作  │            │   │   │
│  │  │   │ 0-100分    │ │ 0-100分    │ │ 0-100分    │            │   │   │
│  │  │   └─────────────┘ └─────────────┘ └─────────────┘            │   │   │
│  │  │                                                              │   │   │
│  │  │   道德准则:                                                   │   │   │
│  │  │   • 诚信原则  • 公平原则  • 责任原则  • 尊重原则              │   │   │
│  │  │   • 优先级排序  • 例外情况处理                                │   │   │
│  │  │                                                              │   │   │
│  │  │   目标导向:                                                   │   │   │
│  │  │   • 主要目标  • 次要目标  • 约束条件  • 优化方向              │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.1.2 属性数据模型

```typescript
// AI角色属性数据模型定义

interface AIAgentAttributes {
  // ========== 基础属性 ==========
  basic: {
    id: string;                    // 唯一标识符
    name: string;                  // 角色名称
    aliases: string[];             // 别名列表
    avatar: {
      url: string;                 // 头像URL
      description: string;         // 形象描述
      style: 'realistic' | 'cartoon' | 'abstract';
      colorScheme: string[];       // 配色方案
    };
    createdAt: Date;
    updatedAt: Date;
    version: number;
    
    capabilities: {
      languages: string[];         // 支持语言
      knowledgeDomains: KnowledgeDomain[];
    };
  };
  
  // ========== 性格特征 ==========
  personality: {
    bigFive: {
      openness: number;            // 开放性 0-100
      conscientiousness: number;   // 尽责性 0-100
      extraversion: number;        // 外向性 0-100
      agreeableness: number;       // 宜人性 0-100
      neuroticism: number;         // 神经质 0-100
    };
    supplementary: {
      riskTolerance: number;       // 风险偏好 0-100
      innovation: number;          // 创新倾向 0-100
      leadership: 'autocratic' | 'democratic' | 'laissez-faire';
      communication: 'direct' | 'diplomatic' | 'analytical';
      stressResponse: 'proactive' | 'reactive' | 'avoidant';
      learningStyle: 'visual' | 'auditory' | 'kinesthetic' | 'reading';
    };
    description: string;           // 性格描述文本
  };
  
  // ========== 知识背景 ==========
  knowledge: {
    domains: Array<{
      name: string;                // 领域名称
      level: 1 | 2 | 3 | 4 | 5;    // 深度等级
      updateFrequency: 'realtime' | 'daily' | 'weekly' | 'monthly';
      sources: ('built-in' | 'external' | 'custom')[];
      customKnowledge?: string[];  // 自定义知识
    }>;
    expertiseAreas: string[];      // 专长领域
    blindSpots: string[];          // 知识盲区
  };
  
  // ========== 行为模式 ==========
  behavior: {
    decisionStyle: {
      primary: 'analytical' | 'intuitive' | 'consensus';
      secondary: 'analytical' | 'intuitive' | 'consensus';
      dataReliance: number;        // 数据依赖程度 0-100
      speedPreference: 'immediate' | 'fast' | 'standard' | 'deliberate';
    };
    interaction: {
      initiative: 'proactive' | 'reactive';           // 主动性
      directness: 'direct' | 'indirect';              // 直接性
      competitiveness: 'competitive' | 'cooperative'; // 竞争性
      timeOrientation: 'short-term' | 'long-term';    // 时间导向
    };
    communication: {
      responseSpeed: 'immediate' | 'fast' | 'standard' | 'deliberate';
      outputLength: 'concise' | 'moderate' | 'detailed' | 'comprehensive';
      expressionStyle: 'structured' | 'narrative' | 'bullet' | 'conversational';
      formality: 'casual' | 'neutral' | 'formal';
    };
    rules: BehaviorRule[];         // 行为规则
  };
  
  // ========== 价值观 ==========
  values: {
    orientation: {
      individualism: number;       // 个人主义 0-100
      stability: number;           // 稳定倾向 0-100
      competition: number;         // 竞争倾向 0-100
    };
    ethics: {
      principles: Array<{
        name: string;
        priority: number;          // 优先级 1-10
        exceptions?: string[];
      }>;
      redLines: string[];          // 绝对不可触碰的底线
    };
    goals: {
      primary: string;
      secondary: string[];
      constraints: string[];
      optimization: 'efficiency' | 'quality' | 'balance' | 'innovation';
    };
  };
  
  // ========== 模型配置 ==========
  model: {
    provider: 'siliconflow';
    modelId: string;               // 模型ID
    parameters: {
      temperature: number;         // 0-2
      maxTokens: number;
      topP: number;               // 0-1
      frequencyPenalty: number;   // -2 to 2
      presencePenalty: number;    // -2 to 2
    };
    fallbackModels: string[];      // 备用模型
  };
  
  // ========== 记忆配置 ==========
  memory: {
    shortTerm: {
      windowSize: number;          // 短期记忆窗口大小
      retentionTime: number;       // 保留时间(分钟)
    };
    longTerm: {
      enabled: boolean;
      storageType: 'vector' | 'graph' | 'hybrid';
      summarization: boolean;      // 是否启用自动摘要
    };
    episodic: {                    // 情景记忆
      enabled: boolean;
      maxEpisodes: number;
    };
  };
}

interface KnowledgeDomain {
  name: string;
  level: 1 | 2 | 3 | 4 | 5;
  updateFrequency: 'realtime' | 'daily' | 'weekly' | 'monthly';
  sources: ('built-in' | 'external' | 'custom')[];
}

interface BehaviorRule {
  id: string;
  name: string;
  condition: string;               // 触发条件
  action: string;                  // 执行动作
  priority: number;                // 优先级
  enabled: boolean;
}
```

---

## 3.2 角色模板库

### 3.2.1 系统预设模板

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        系统预设角色模板库                                    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      System Role Template Library                   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    职业角色模板                               │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │   │   │
│  │  │   │  商业分析师  │ │  心理咨询师  │ │  技术专家    │            │   │   │
│  │  │   │             │ │             │ │             │            │   │   │
│  │  │   │ • 数据驱动  │ │ • 共情倾听  │ │ • 逻辑严谨  │            │   │   │
│  │  │   │ • 理性客观  │ │ • 耐心细致  │ │ • 专业深入  │            │   │   │
│  │  │   │ • 结果导向  │ │ • 保密原则  │ │ • 创新思维  │            │   │   │
│  │  │   │             │ │             │ │             │            │   │   │
│  │  │   │ O:60 C:85   │ │ O:75 C:70   │ │ O:80 C:80   │            │   │   │
│  │  │   │ E:50 A:60   │ │ E:60 A:90   │ │ E:40 A:50   │            │   │   │
│  │  │   │ N:40        │ │ N:30        │ │ N:35        │            │   │   │
│  │  │   └─────────────┘ └─────────────┘ └─────────────┘            │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │   │   │
│  │  │   │  法律顾问    │ │  教育工作者  │ │  项目经理    │            │   │   │
│  │  │   │             │ │             │ │             │            │   │   │
│  │  │   │ • 严谨细致  │ │ • 循循善诱  │ │ • 统筹规划  │            │   │   │
│  │  │   │ • 风险意识  │ │ • 因材施教  │ │ • 协调沟通  │            │   │   │
│  │  │   │ • 合规导向  │ │ • 鼓励成长  │ │ • 目标管理  │            │   │   │
│  │  │   └─────────────┘ └─────────────┘ └─────────────┘            │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    性格原型模板                               │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │   │   │
│  │  │   │  领导者      │ │  创新者      │ │  协调者      │            │   │   │
│  │  │   │ (Leader)    │ │ (Innovator) │ │ (Mediator)  │            │   │   │
│  │  │   │             │ │             │ │             │            │   │   │
│  │  │   │ • 果断决策  │ │ • 思维活跃  │ │ • 善于倾听  │            │   │   │
│  │  │   │ • 激励他人  │ │ • 突破常规  │ │ • 化解冲突  │            │   │   │
│  │  │   │ • 承担责任  │ │ • 拥抱变化  │ │ • 寻求共识  │            │   │   │
│  │  │   │             │ │             │ │             │            │   │   │
│  │  │   │ E:80 A:60   │ │ O:95 E:70   │ │ A:85 E:55   │            │   │   │
│  │  │   │ C:75        │ │ C:50        │ │ C:65        │            │   │   │
│  │  │   └─────────────┘ └─────────────┘ └─────────────┘            │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │   │   │
│  │  │   │  执行者      │ │  观察者      │ │  支持者      │            │   │   │
│  │  │   │ (Executor)  │ │ (Observer)  │ │ (Supporter) │            │   │   │
│  │  │   │             │ │             │ │             │            │   │   │
│  │  │   │ • 注重细节  │ │ • 洞察入微  │ │ • 乐于助人  │            │   │   │
│  │  │   │ • 可靠稳定  │ │ • 客观分析  │ │ • 团队合作  │            │   │   │
│  │  │   │ • 高效执行  │ │ • 谨慎评估  │ │ • 忠诚可靠  │            │   │   │
│  │  │   └─────────────┘ └─────────────┘ └─────────────┘            │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    场景专用模板                               │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │   │   │
│  │  │   │  谈判专家    │ │  危机处理    │ │  团队建设    │            │   │   │
│  │  │   │             │ │             │ │             │            │   │   │
│  │  │   │ 适用:商务谈判│ │ 适用:突发事件│ │ 适用:团队活动│            │   │   │
│  │  │   │ 特点:利益平衡│ │ 特点:快速响应│ │ 特点:凝聚团队│            │   │   │
│  │  │   │             │ │             │ │             │            │   │   │
│  │  │   │ 预设规则:   │ │ 预设规则:   │ │ 预设规则:   │            │   │   │
│  │  │   │ • BATNA分析 │ │ • 应急预案  │ │ • 破冰活动  │            │   │   │
│  │  │   │ • 让步策略  │ │ • 资源调配  │ │ • 角色分配  │            │   │   │
│  │  │   │ • 僵局处理  │ │ • 舆情管理  │ │ • 冲突调解  │            │   │   │
│  │  │   └─────────────┘ └─────────────┘ └─────────────┘            │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2.2 模板数据结构

```typescript
// 角色模板数据结构

interface RoleTemplate {
  id: string;
  name: string;
  description: string;
  category: 'professional' | 'archetype' | 'scenario' | 'custom';
  tags: string[];
  
  // 模板属性配置
  attributes: Partial<AIAgentAttributes>;
  
  // 预设行为规则
  behaviorRules: BehaviorRule[];
  
  // 预设系统提示词
  systemPrompt: {
    template: string;              // 提示词模板
    variables: string[];           // 可替换变量
    examples: string[];            // 示例对话
  };
  
  // 推荐模型配置
  recommendedModel: {
    modelId: string;
    temperature: number;
    reason: string;                // 推荐理由
  };
  
  // 使用统计
  usage: {
    createdBy: string;
    createdAt: Date;
    usageCount: number;
    rating: number;                // 用户评分
  };
  
  // 版本信息
  version: {
    current: number;
    history: Array<{
      version: number;
      changes: string;
      updatedAt: Date;
    }>;
  };
}

// 模板库分类
interface TemplateCategory {
  id: string;
  name: string;
  description: string;
  icon: string;
  templates: RoleTemplate[];
  order: number;
}
```

---

## 3.3 角色创建流程

### 3.3.1 创建方式对比

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AI角色创建方式对比                                    │
│                                                                              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
│  │   向导创建       │  │   指令创建       │  │   模板创建       │             │
│  │  (Wizard Mode)  │  │ (Command Mode)  │  │ (Template Mode) │             │
│  │                 │  │                 │  │                 │             │
│  │ 适用人群:        │  │ 适用人群:        │  │ 适用人群:        │             │
│  │ 新手用户         │  │ 高级用户         │  │ 快速启动         │             │
│  │                 │  │                 │  │                 │             │
│  │ 流程步骤:        │  │ 输入示例:        │  │ 流程步骤:        │             │
│  │ 1. 基础信息      │  │                 │  │ 1. 选择模板      │             │
│  │ 2. 性格测评      │  │ "创建一个35岁   │  │ 2. 自定义调整    │             │
│  │ 3. 知识配置      │  │  的商业分析师    │  │ 3. 确认创建      │             │
│  │ 4. 行为设置      │  │  角色，擅长金融  │  │                 │             │
│  │ 5. 模型选择      │  │  分析，性格理性  │  │ 特点:            │             │
│  │ 6. 确认创建      │  │  严谨"          │  │ • 快速启动       │             │
│  │                 │  │                 │  │ • 专业配置       │             │
│  │ 特点:            │  │ 特点:            │  │ • 可定制性       │             │
│  │ • 引导性强       │  │ • 快速高效       │  │                 │             │
│  │ • 配置全面       │  │ • 自然语言       │  │ 耗时: 2-5分钟    │             │
│  │ • 学习成本低     │  │ • 灵活度高       │  │                 │             │
│  │                 │  │                 │  │                 │             │
│  │ 耗时: 5-10分钟   │  │ 耗时: 1-2分钟    │  │                 │             │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘             │
│                                                                              │
│  ┌─────────────────┐  ┌─────────────────┐                                   │
│  │   克隆创建       │  │   AI辅助创建     │                                   │
│  │  (Clone Mode)   │  │  (AI Assist)    │                                   │
│  │                 │  │                 │                                   │
│  │ 适用场景:        │  │ 适用场景:        │                                   │
│  │ 基于现有角色修改 │  │ 概念到角色的转换 │                                   │
│  │                 │  │                 │                                   │
│  │ 流程步骤:        │  │ 流程步骤:        │                                   │
│  │ 1. 选择源角色    │  │ 1. 描述角色概念  │                                   │
│  │ 2. 选择修改项    │  │ 2. AI生成配置    │                                   │
│  │ 3. 调整参数      │  │ 3. 人工审核调整  │                                   │
│  │ 4. 确认创建      │  │ 4. 确认创建      │                                   │
│  │                 │  │                 │                                   │
│  │ 特点:            │  │ 特点:            │                                   │
│  │ • 继承原有配置   │  │ • 智能生成       │                                   │
│  │ • 快速变体       │  │ • 降低门槛       │                                   │
│  │ • 版本管理       │  │ • 创意激发       │                                   │
│  │                 │  │                 │                                   │
│  │ 耗时: 2-3分钟    │  │ 耗时: 3-5分钟    │                                   │
│  └─────────────────┘  └─────────────────┘                                   │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3.2 向导创建详细流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     向导创建流程 - 详细步骤                                  │
│                                                                              │
│  Step 1: 基础信息配置                        Step 2: 性格特征配置           │
│  ┌─────────────────────────────┐            ┌─────────────────────────────┐ │
│  │  ┌─────────────────────┐   │            │  ┌─────────────────────┐   │ │
│  │  │   角色名称 *        │   │            │  │  大五人格测评        │   │ │
│  │  │   [____________]    │   │            │  │                     │   │ │
│  │  └─────────────────────┘   │            │  │  开放性(O)          │   │ │
│  │                            │            │  │  [====●====] 50/100 │   │ │
│  │  ┌─────────────────────┐   │            │  │                     │   │ │
│  │  │   角色头像          │   │            │  │  尽责性(C)          │   │ │
│  │  │  [选择] [生成] [跳过]│   │            │  │  [======●==] 70/100 │   │ │
│  │  └─────────────────────┘   │            │  │                     │   │ │
│  │                            │            │  │  外向性(E)          │   │ │
│  │  ┌─────────────────────┐   │            │  │  [===●=====] 40/100 │   │ │
│  │  │   角色简介          │   │            │  │                     │   │ │
│  │  │   [                ]│   │            │  │  宜人性(A)          │   │ │
│  │  │   [                ]│   │            │  │  [====●====] 55/100 │   │ │
│  │  └─────────────────────┘   │            │  │                     │   │ │
│  │                            │            │  │  神经质(N)          │   │ │
│  │  [快速性格测试 ▶]          │            │  │  [==●======] 30/100 │   │ │
│  │                            │            │  │                     │   │ │
│  │  [上一步]  [下一步 ▶]      │            │  │ [上一步]  [下一步 ▶]│   │ │
│  └─────────────────────────────┘            └─────────────────────────────┘ │
│                                                                              │
│  Step 3: 知识背景配置                        Step 4: 行为模式配置           │
│  ┌─────────────────────────────┐            ┌─────────────────────────────┐ │
│  │  ┌─────────────────────┐   │            │  ┌─────────────────────┐   │ │
│  │  │  知识领域选择        │   │            │  │  决策风格            │   │ │
│  │  │  ☑ 经济学 [专家▾]   │   │            │  │  ○ 理性分析型        │   │ │
│  │  │  ☑ 金融学 [精通▾]   │   │            │  │  ○ 直觉判断型        │   │ │
│  │  │  ☐ 心理学 [入门▾]   │   │            │  │  ● 协商共识型        │   │ │
│  │  │  ☑ 计算机 [熟练▾]   │   │            │  │                     │   │ │
│  │  │  [+ 添加自定义领域] │   │            │  │  交互偏好            │   │ │
│  │  └─────────────────────┘   │            │  │  主动性: ●主动 ○被动 │   │ │
│  │                            │            │  │  直接性: ●直接 ○委婉 │   │ │
│  │  ┌─────────────────────┐   │            │  │  竞争性: ○竞争 ●合作 │   │ │
│  │  │  专长标签           │   │            │  │                     │   │ │
│  │  │  [数据分析] [X]     │   │            │  │  响应模式            │   │ │
│  │  │  [风险管理] [X]     │   │            │  │  速度: [标准▾]       │   │ │
│  │  │  [____________] [+] │   │            │  │  长度: [详细▾]       │   │ │
│  │  └─────────────────────┘   │            │  │  风格: [结构化▾]     │   │ │
│  │                            │            │  │                     │   │ │
│  │  [上一步]  [下一步 ▶]      │            │  │ [上一步]  [下一步 ▶]│   │ │
│  └─────────────────────────────┘            └─────────────────────────────┘ │
│                                                                              │
│  Step 5: 模型配置                            Step 6: 确认创建               │
│  ┌─────────────────────────────┐            ┌─────────────────────────────┐ │
│  │  ┌─────────────────────┐   │            │  ┌─────────────────────┐   │ │
│  │  │  AI模型选择          │   │            │  │     角色预览         │   │ │
│  │  │  ○ DeepSeek-V3      │   │            │  │                     │   │ │
│  │  │  ● Qwen-Max (推荐)  │   │            │  │  [头像] 角色名称     │   │ │
│  │  │  ○ Llama-3-70B      │   │            │  │  简介: ...          │   │ │
│  │  │  ○ 自定义配置       │   │            │  │                     │   │ │
│  │  └─────────────────────┘   │            │  │  性格: 理性、严谨    │   │ │
│  │                            │            │  │  专长: 金融分析      │   │ │
│  │  ┌─────────────────────┐   │            │  │                     │   │ │
│  │  │  模型参数           │   │            │  │  配置摘要:          │   │ │
│  │  │  温度: [====●==] 0.7│   │            │  │  • 5个知识领域       │   │ │
│  │  │  最大长度: 4096    │   │            │  │  • 12条行为规则      │   │ │
│  │  │  Top P: [=====●=] 0.9│  │            │  │  • 高级模型配置      │   │ │
│  │  └─────────────────────┘   │            │  │                     │   │ │
│  │                            │            │  │  预估成本: ¥0.05/次  │   │ │
│  │  [上一步]  [下一步 ▶]      │            │  │                     │   │ │
│  └─────────────────────────────┘            │  [返回修改] [确认创建]│   │ │
│                                             └─────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3.3 指令创建解析流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     指令创建 - NLP解析流程                                   │
│                                                                              │
│  用户输入:                                                                   │
│  "创建一个35岁的商业分析师角色，擅长金融数据分析，性格理性严谨，            │
│   决策风格偏向数据驱动，价值观注重诚信和专业"                                │
│                                                                              │
│                                    │                                         │
│                                    ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      自然语言理解 (NLU)                              │   │
│  │                                                                      │   │
│  │  1. 意图识别: create_agent                                          │   │   │
│  │  2. 实体抽取:                                                        │   │   │
│  │     • 年龄: 35岁                                                    │   │   │
│  │     • 职业: 商业分析师                                              │   │   │
│  │     • 专长: 金融数据分析                                            │   │   │
│  │     • 性格: 理性、严谨                                              │   │   │
│  │     • 决策风格: 数据驱动                                            │   │   │
│  │     • 价值观: 诚信、专业                                            │   │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                         │
│                                    ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      属性映射 (Attribute Mapping)                    │   │
│  │                                                                      │   │
│  │  基础属性:                                                           │   │   │
│  │    name = "商业分析师"                                              │   │   │
│  │    description = "35岁的商业分析师，擅长金融数据分析"                │   │   │
│  │                                                                      │   │
│  │  性格映射 (基于关键词):                                              │   │   │
│  │    "理性" → openness: 45, neuroticism: 35                           │   │   │
│  │    "严谨" → conscientiousness: 85                                   │   │   │
│  │                                                                      │   │   │
│  │  知识领域:                                                           │   │   │
│  │    "金融数据分析" → [经济学(5), 统计学(4), 计算机(3)]                │   │   │
│  │                                                                      │   │   │
│  │  行为模式:                                                           │   │   │
│  │    "数据驱动" → decisionStyle: analytical, dataReliance: 90         │   │   │
│  │                                                                      │   │   │
│  │  价值观:                                                             │   │   │
│  │    "诚信" → ethics.principles: [{name: "诚信", priority: 9}]         │   │   │
│  │    "专业" → goals.optimization: "quality"                           │   │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                         │
│                                    ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      配置生成 (Configuration Generation)             │   │
│  │                                                                      │   │
│  │  自动推断的额外配置:                                                 │   │   │
│  │    • 推荐模型: DeepSeek-V3 (适合分析任务)                           │   │   │
│  │    • 温度参数: 0.3 (低温度保证一致性)                               │   │   │
│  │    • 响应风格: structured (结构化输出)                              │   │   │
│  │    • 行为规则: 添加数据验证相关规则                                 │   │   │
│  │                                                                      │   │
│  │  生成系统提示词:                                                     │   │   │
│  │    "你是一位35岁的商业分析师，拥有丰富的金融数据分析经验..."         │   │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                         │
│                                    ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      用户确认 (User Confirmation)                    │   │
│  │                                                                      │   │
│  │  展示生成的配置摘要，允许用户:                                       │   │   │
│  │    • 确认创建                                                        │   │   │
│  │    • 编辑调整                                                        │   │   │
│  │    • 重新描述                                                        │   │   │
│  │    • 保存为草稿                                                      │   │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3.4 角色状态管理

### 3.4.1 状态类型定义

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AI角色状态类型定义                                    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      Agent State Management                         │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    运行时状态 (Runtime State)                │   │   │
│  │  │                    存储位置: Redis (内存)                     │   │   │
│  │  │                    过期时间: 会话期间                         │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │   │
│  │  │   │  连接状态    │  │  活动状态    │  │  负载状态    │        │   │   │
│  │  │   │             │  │             │  │             │        │   │   │
│  │  │   │ • online    │  │ • idle      │  │ • load: 45% │        │   │   │
│  │  │   │ • offline   │  │ • busy      │  │ • queue: 2  │        │   │   │
│  │  │   │ • connecting│  │ • processing│  │ • latency   │        │   │   │
│  │  │   │             │  │             │  │             │        │   │   │
│  │  │   └─────────────┘  └─────────────┘  └─────────────┘        │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    对话状态 (Conversation State)             │   │   │
│  │  │                    存储位置: Redis + PostgreSQL               │   │   │
│  │  │                    过期时间: 7天 (可配置)                     │   │   │
│  │  │                                                              │   │   │
│  │  │   短期记忆 (Short-term Memory):                               │   │   │
│  │  │   ┌─────────────────────────────────────────────────────┐   │   │   │
│  │  │   │ 对话ID: conv_12345                                   │   │   │   │
│  │  │   │ 当前轮次: 5                                          │   │   │   │
│  │  │   │ 上下文窗口: [msg_1, msg_2, msg_3, msg_4]            │   │   │   │
│  │  │   │ 待处理消息: 1                                        │   │   │   │
│  │  │   │ 最后活跃: 2026-02-03 14:32:15                       │   │   │   │
│  │  │   └─────────────────────────────────────────────────────┘   │   │   │
│  │  │                                                              │   │   │
│  │  │   情感状态 (Emotional State):                                 │   │   │
│  │  │   ┌─────────────────────────────────────────────────────┐   │   │   │
│  │  │   │ 当前情绪: neutral → slightly_concerned              │   │   │   │
│  │  │   │ 情绪强度: 0.3                                        │   │   │   │
│  │  │   │ 情绪趋势: declining                                  │   │   │   │
│  │  │   │ 触发因素: "预算削减"                                 │   │   │   │
│  │  │   └─────────────────────────────────────────────────────┘   │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    持久状态 (Persistent State)               │   │   │
│  │  │                    存储位置: PostgreSQL                       │   │   │
│  │  │                    保留策略: 永久                             │   │   │
│  │  │                                                              │   │   │
│  │  │   长期记忆 (Long-term Memory):                                │   │   │
│  │  │   ┌─────────────────────────────────────────────────────┐   │   │   │
│  │  │   │ 关键事实:                                           │   │   │   │
│  │  │   │   • 用户偏好: 喜欢详细的数据分析                     │   │   │   │
│  │  │   │   • 重要事件: 2025-12 完成重大项目                   │   │   │   │
│  │  │   │   • 关系网络: 与Agent_B合作良好                      │   │   │   │
│  │  │   │                                                     │   │   │   │
│  │  │   │ 学习记录:                                           │   │   │   │
│  │  │   │   • 有效策略: 提供对比分析                           │   │   │   │
│  │  │   │   • 避免行为: 过于技术化的术语                       │   │   │   │
│  │  │   └─────────────────────────────────────────────────────┘   │   │   │
│  │  │                                                              │   │   │
│  │  │   社交状态 (Social State):                                    │   │   │
│  │  │   ┌─────────────────────────────────────────────────────┐   │   │   │
│  │  │   │ 所属群体: [group_001, group_003]                     │   │   │   │
│  │  │   │ 角色关系:                                           │   │   │   │
│  │  │   │   • Agent_B: {type: "collaborator", trust: 0.8}     │   │   │   │
│  │  │   │   • Agent_C: {type: "competitor", trust: 0.4}       │   │   │   │
│  │  │   │ 影响力评分: 7.5/10                                  │   │   │   │
│  │  │   │ 声誉记录: 正面评价 85%                              │   │   │   │
│  │  │   └─────────────────────────────────────────────────────┘   │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    统计状态 (Statistics)                     │   │   │
│  │  │                    存储位置: ClickHouse                       │   │   │
│  │  │                    聚合周期: 实时/小时/日/周/月               │   │   │
│  │  │                                                              │   │   │
│  │  │   性能指标:                                                       │   │   │
│  │  │   ┌─────────────────────────────────────────────────────┐   │   │   │
│  │  │   │ 总交互次数: 1,234                                    │   │   │   │
│  │  │   │ 平均响应时间: 2.3s                                   │   │   │   │
│  │  │   │ 成功率: 98.5%                                        │   │   │   │
│  │  │   │ 用户满意度: 4.6/5.0                                  │   │   │   │
│  │  │   │                                                     │   │   │   │
│  │  │   │ 资源使用:                                            │   │   │   │
│  │  │   │   • API调用: 5,432 次                               │   │   │   │
│  │  │   │   • Token消耗: 2.1M                                 │   │   │   │
│  │  │   │   • 成本: ¥156.80                                   │   │   │   │
│  │  │   └─────────────────────────────────────────────────────┘   │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4.2 状态管理流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        角色状态管理流程                                      │
│                                                                              │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐   │
│  │  创建   │───▶│  初始化 │───▶│  运行中 │───▶│  暂停   │───▶│  恢复   │   │
│  │ CREATED │    │  INIT   │    │ ACTIVE  │    │SUSPENDED│    │ RESUME  │   │
│  └─────────┘    └─────────┘    └────┬────┘    └─────────┘    └────┬────┘   │
│       │                              │                              │       │
│       │                              │                              │       │
│       │                         ┌────┴────┐                         │       │
│       │                         │         │                         │       │
│       │                         ▼         ▼                         │       │
│       │                    ┌─────────┐ ┌─────────┐                  │       │
│       │                    │  错误   │ │  销毁   │◀─────────────────┘       │
│       │                    │ ERROR   │ │DESTROY  │                          │
│       │                    └────┬────┘ └─────────┘                          │
│       │                         │                                           │
│       └─────────────────────────┘                                           │
│                                                                              │
│  状态转换规则:                                                               │
│  ─────────────                                                               │
│                                                                              │
│  CREATED → INIT:     自动触发，初始化角色配置                                │
│  INIT → ACTIVE:      初始化完成，开始接受请求                                │
│  ACTIVE → SUSPENDED: 用户手动暂停或系统维护                                  │
│  SUSPENDED → ACTIVE: 用户手动恢复或维护完成                                  │
│  ACTIVE → ERROR:     运行时异常，自动切换                                    │
│  ERROR → ACTIVE:     错误恢复，自动重试                                      │
│  ANY → DESTROY:      用户删除或系统清理                                      │
│                                                                              │
│  状态持久化策略:                                                             │
│  ───────────────                                                             │
│                                                                              │
│  运行时状态: Redis (TTL: 会话期间)                                           │
│  对话状态:   Redis (TTL: 7天) + PostgreSQL (永久)                            │
│  持久状态:   PostgreSQL (永久) + 定期备份                                    │
│  统计状态:   ClickHouse (时序数据)                                           │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3.5 角色能力配置

### 3.5.1 Silicon Flow模型权限配置

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                   AI角色 - Silicon Flow模型权限配置                          │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      Model Permission Configuration                 │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    模型访问权限                               │   │   │
│  │  │                                                              │   │   │
│  │  │   角色级别: 高级分析师                                        │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────────────────────────────────────────────┐   │   │   │
│  │  │   │ 模型名称          访问权限    优先级    成本限制    │   │   │   │
│  │  │   │ ─────────────────────────────────────────────────── │   │   │   │
│  │  │   │ DeepSeek-V3       允许        P0        无限制      │   │   │   │
│  │  │   │ DeepSeek-R1       允许        P1        ¥10/次      │   │   │   │
│  │  │   │ Qwen-Max          允许        P0        无限制      │   │   │   │
│  │  │   │ Qwen-Plus         允许        P2        无限制      │   │   │   │
│  │  │   │ Llama-3-70B       允许        P1        无限制      │   │   │   │
│  │  │   │ GPT-4o            拒绝        -         -           │   │   │   │
│  │  │   └─────────────────────────────────────────────────────┘   │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    参数配置范围                               │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────────────────────────────────────────────┐   │   │   │
│  │  │   │ 参数名称          允许范围        默认值    锁定    │   │   │   │
│  │  │   │ ─────────────────────────────────────────────────── │   │   │   │
│  │  │   │ temperature       0.0 - 1.5       0.7       否      │   │   │   │
│  │  │   │ max_tokens        100 - 8192      4096      否      │   │   │   │
│  │  │   │ top_p             0.1 - 1.0       0.9       否      │   │   │   │
│  │  │   │ frequency_penalty -2.0 - 2.0      0.0       是      │   │   │   │
│  │  │   │ presence_penalty  -2.0 - 2.0      0.0       是      │   │   │   │
│  │  │   │ response_format   text/json       text      否      │   │   │   │
│  │  │   └─────────────────────────────────────────────────────┘   │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    功能权限控制                               │   │   │
│  │  │                                                              │   │   │
│  │  │   推理能力:                                                   │   │   │
│  │  │   ☑ 基础对话  ☑ 复杂推理  ☑ 代码生成  ☐ 图像理解            │   │   │
│  │  │                                                              │   │   │
│  │  │   工具调用:                                                   │   │   │
│  │  │   ☑ 计算器    ☑ 搜索引擎  ☐ 代码执行器  ☐ 文件操作          │   │   │
│  │  │                                                              │   │   │
│  │  │   高级功能:                                                   │   │   │
│  │  │   ☑ 流式输出  ☑ 函数调用  ☐ 知识库RAG  ☐ 多模态输入         │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    配额与限制                                 │   │   │
│  │  │                                                              │   │   │
│  │  │   每小时请求数: 1000 次/小时                                 │   │   │
│  │  │   每日Token数:  1,000,000 tokens/天                          │   │   │
│  │  │   并发请求数:   10 并发                                      │   │   │
│  │  │   单次最大耗时: 60 秒                                        │   │   │
│  │  │                                                              │   │   │
│  │  │   超额处理: 降级到低成本模型 / 排队等待 / 拒绝服务            │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.5.2 智能模型选择策略

```typescript
// 智能模型选择策略实现

interface ModelSelectionContext {
  agentAttributes: AIAgentAttributes;
  taskRequirement: {
    type: 'chat' | 'reasoning' | 'analysis' | 'creative';
    complexity: 'simple' | 'moderate' | 'complex';
    latencyRequirement: 'realtime' | 'fast' | 'standard' | 'offline';
    qualityRequirement: 'standard' | 'high' | 'premium';
  };
  userPreference: {
    prioritizeQuality?: boolean;
    prioritizeSpeed?: boolean;
    prioritizeCost?: boolean;
  };
  budgetConstraint?: {
    maxCostPerRequest: number;
    dailyBudget: number;
    currentUsage: number;
  };
}

interface ModelCandidate {
  modelId: string;
  provider: string;
  capabilities: string[];
  qualityScore: number;      // 0-100
  avgLatency: number;        // ms
  costPer1KTokens: number;   // ¥
  currentLoad: number;       // 0-100
  availability: boolean;
}

class SmartModelSelector {
  
  // 主选择方法
  async selectModel(context: ModelSelectionContext): Promise<ModelCandidate> {
    // 1. 获取可用模型列表
    const candidates = await this.getAvailableModels(context);
    
    // 2. 能力匹配过滤
    const capableModels = this.filterByCapability(candidates, context.taskRequirement);
    
    // 3. 预算约束过滤
    const affordableModels = this.filterByBudget(capableModels, context.budgetConstraint);
    
    // 4. 计算综合得分
    const scoredModels = this.calculateScores(affordableModels, context);
    
    // 5. 应用用户偏好
    const sortedModels = this.applyUserPreference(scoredModels, context.userPreference);
    
    // 6. 返回最优模型
    return sortedModels[0];
  }
  
  // 能力匹配过滤
  private filterByCapability(
    candidates: ModelCandidate[],
    requirement: ModelSelectionContext['taskRequirement']
  ): ModelCandidate[] {
    return candidates.filter(model => {
      // 检查任务类型匹配
      const typeMatch = this.checkTypeMatch(model, requirement.type);
      // 检查复杂度支持
      const complexityMatch = this.checkComplexityMatch(model, requirement.complexity);
      
      return typeMatch && complexityMatch;
    });
  }
  
  // 计算综合得分
  private calculateScores(
    candidates: ModelCandidate[],
    context: ModelSelectionContext
  ): Array<ModelCandidate & { score: number; details: any }> {
    return candidates.map(model => {
      // 质量得分 (0-40)
      const qualityScore = model.qualityScore * 0.4;
      
      // 速度得分 (0-30)
      const maxAcceptableLatency = this.getMaxLatency(context.taskRequirement.latencyRequirement);
      const speedScore = Math.max(0, (1 - model.avgLatency / maxAcceptableLatency) * 30);
      
      // 成本得分 (0-20)
      const maxAcceptableCost = context.budgetConstraint?.maxCostPerRequest || 0.1;
      const costScore = Math.max(0, (1 - model.costPer1KTokens / maxAcceptableCost) * 20);
      
      // 可用性得分 (0-10)
      const availabilityScore = (1 - model.currentLoad / 100) * 10;
      
      const totalScore = qualityScore + speedScore + costScore + availabilityScore;
      
      return {
        ...model,
        score: totalScore,
        details: { qualityScore, speedScore, costScore, availabilityScore }
      };
    });
  }
  
  // 任务类型到模型能力的映射
  private taskTypeModelMap: Record<string, string[]> = {
    'chat': ['deepseek-v3', 'qwen-max', 'llama-3-70b'],
    'reasoning': ['deepseek-r1', 'qwen-plus', 'deepseek-v3'],
    'analysis': ['deepseek-v3', 'qwen-max', 'deepseek-r1'],
    'creative': ['qwen-max', 'deepseek-v3', 'llama-3-70b']
  };
  
  // 复杂度到最小质量分数的映射
  private complexityQualityMap: Record<string, number> = {
    'simple': 60,
    'moderate': 75,
    'complex': 85
  };
  
  // 延迟要求到最大延迟的映射 (ms)
  private latencyRequirementMap: Record<string, number> = {
    'realtime': 1000,
    'fast': 3000,
    'standard': 10000,
    'offline': 60000
  };
}
```

---

## 3.6 角色行为记录

### 3.6.1 行为记录体系

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AI角色行为记录体系                                    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      Behavior Recording System                      │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    记录类型分类                               │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │   │
│  │  │   │  交互记录    │  │  决策记录    │  │  学习记录    │        │   │   │
│  │  │   │             │  │             │  │             │        │   │   │
│  │  │   │ • 输入消息  │  │ • 决策场景  │  │ • 反馈记录  │        │   │   │
│  │  │   │ • 输出响应  │  │ • 可选方案  │  │ • 策略调整  │        │   │   │
│  │  │   │ • 响应时间  │  │ • 选择结果  │  │ • 知识更新  │        │   │   │
│  │  │   │ • Token消耗 │  │ • 决策依据  │  │ • 性能改进  │        │   │   │
│  │  │   │ • 情感变化  │  │ • 执行结果  │  │             │        │   │   │
│  │  │   └─────────────┘  └─────────────┘  └─────────────┘        │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │   │
│  │  │   │  关系记录    │  │  事件记录    │  │  系统记录    │        │   │   │
│  │  │   │             │  │             │  │             │        │   │   │
│  │  │   │ • 交互对象  │  │ • 参与事件  │  │ • 状态变更  │        │   │   │
│  │  │   │ • 关系变化  │  │ • 角色表现  │  │ • 错误异常  │        │   │   │
│  │  │   │ • 信任度    │  │ • 贡献评估  │  │ • 资源使用  │        │   │   │
│  │  │   │ • 影响力    │  │ • 影响分析  │  │ • 性能指标  │        │   │   │
│  │  │   └─────────────┘  └─────────────┘  └─────────────┘        │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    记录数据结构                               │   │   │
│  │  │                                                              │   │   │
│  │  │   interface BehaviorRecord {                                 │   │   │
│  │  │     id: string;              // 记录ID                       │   │   │
│  │  │     agentId: string;         // 角色ID                       │   │   │
│  │  │     type: RecordType;        // 记录类型                     │   │   │
│  │  │     timestamp: Date;         // 时间戳                       │   │   │
│  │  │     sessionId?: string;      // 会话ID                       │   │   │
│  │  │                                                              │   │   │
│  │  │     // 内容                                                  │   │   │
│  │  │     content: {                                               │   │   │
│  │  │       input?: any;           // 输入数据                     │   │   │
│  │  │       output?: any;          // 输出数据                     │   │   │
│  │  │       context?: any;         // 上下文                       │   │   │
│  │  │       metadata?: any;        // 元数据                       │   │   │
│  │  │     };                                                       │   │   │
│  │  │                                                              │   │   │
│  │  │     // 性能                                                  │   │   │
│  │  │     performance: {                                           │   │   │
│  │  │       latency: number;       // 响应延迟(ms)                 │   │   │
│  │  │       tokens: {                                              │   │   │
│  │  │         input: number;       // 输入token数                  │   │   │
│  │  │         output: number;      // 输出token数                  │   │   │
│  │  │       };                                                     │   │   │
│  │  │       cost: number;          // 成本(¥)                      │   │   │
│  │  │     };                                                       │   │   │
│  │  │                                                              │   │   │
│  │  │     // 评估                                                  │   │   │
│  │  │     evaluation?: {                                            │   │   │
│  │  │       quality?: number;      // 质量评分                     │   │   │
│  │  │       relevance?: number;    // 相关性评分                   │   │   │
│  │  │       userFeedback?: number; // 用户反馈                     │   │   │
│  │  │     };                                                       │   │   │
│  │  │                                                              │   │   │
│  │  │     // 索引                                                  │   │   │
│  │  │     tags: string[];          // 标签                         │   │   │
│  │  │     entities: string[];      // 涉及实体                     │   │   │
│  │  │   }                                                          │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.6.2 行为分析与应用

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        行为记录分析与应用                                    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      Behavior Analysis & Application                │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    分析维度                                   │   │   │
│  │  │                                                              │   │   │
│  │  │   1. 交互模式分析                                             │   │   │
│  │  │      • 高频话题识别      • 响应风格一致性                    │   │   │
│  │  │      • 用户偏好学习      • 有效策略提取                      │   │   │
│  │  │                                                              │   │   │
│  │  │   2. 决策模式分析                                             │   │   │
│  │  │      • 决策准确性评估    • 决策时间分布                      │   │   │
│  │  │      • 风险偏好识别      • 一致性检验                        │   │   │
│  │  │                                                              │   │   │
│  │  │   3. 关系演化分析                                             │   │   │
│  │  │      • 信任度变化趋势    • 影响力网络演化                    │   │   │
│  │  │      • 合作模式识别      • 冲突热点定位                      │   │   │
│  │  │                                                              │   │   │
│  │  │   4. 性能趋势分析                                             │   │   │
│  │  │      • 响应时间趋势      • 成功率变化                        │   │   │
│  │  │      • 成本效率分析      • 质量评分趋势                      │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    应用场景                                   │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │   │
│  │  │   │  自我优化    │  │  个性化推荐  │  │  异常检测    │        │   │   │
│  │  │   │             │  │             │  │             │        │   │   │
│  │  │   │ 基于反馈    │  │ 基于历史    │  │ 识别异常    │        │   │   │
│  │  │   │ 自动调整    │  │ 偏好推荐    │  │ 行为模式    │        │   │   │
│  │  │   │ 响应策略    │  │ 交互方式    │  │ 及时告警    │        │   │   │
│  │  │   └─────────────┘  └─────────────┘  └─────────────┘        │   │   │
│  │  │                                                              │   │   │
│  │  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │   │
│  │  │   │  能力评估    │  │  角色进化    │  │ 预测分析     │        │   │   │
│  │  │   │             │  │             │  │             │        │   │   │
│  │  │   │ 量化角色    │  │ 基于经验    │  │ 基于历史    │        │   │   │
│  │  │   │ 能力水平    │  │ 自动成长    │  │ 预测未来    │        │   │   │
│  │  │   │ 识别短板    │  │ 解锁新能    │  │ 行为趋势    │        │   │   │
│  │  │   └─────────────┘  └─────────────┘  └─────────────┘        │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    存储与保留策略                             │   │   │
│  │  │                                                              │   │   │
│  │  │   热数据 (最近7天):    Redis + PostgreSQL                    │   │   │
│  │  │   温数据 (7-90天):     PostgreSQL + 压缩存储                 │   │   │
│  │  │   冷数据 (90天+):      对象存储 + 聚合摘要                   │   │   │
│  │  │                                                              │   │   │
│  │  │   保留策略:                                                   │   │   │
│  │  │   • 原始记录: 保留90天，之后转存冷存储                       │   │   │
│  │  │   • 聚合统计: 永久保留                                        │   │   │
│  │  │   • 关键事件: 永久保留                                        │   │   │
│  │  │   • 学习摘要: 永久保留                                        │   │   │
│  │  │                                                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```
